<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Qu·∫£n L√Ω Nh√† H√†ng ‚Äî Giao Di·ªán</title>
  <link rel="stylesheet" href="/css/style.css" />
  <script>
    // Ki·ªÉm tra authentication tr∆∞·ªõc khi load trang
    if (!sessionStorage.getItem('isAuthenticated') || sessionStorage.getItem('isAuthenticated') !== 'true') {
      window.location.href = '/login.html';
    }
  </script>
</head>
<body>
  <div class="app">
    <!-- Sidebar Menu -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo">RM</div>
        <div>
          <div style="font-weight:700">Qu·∫£n L√Ω Nh√† H√†ng</div>
          <div class="small">Nh√≥m 19</div>
        </div>
      </div>
      <nav class="nav" id="mainNav">
        <a href="#" class="active" data-page="tables" onclick="showPage('tables'); return false;">ü™ë Tr·∫°ng th√°i b√†n</a>
        <a href="#" data-page="menu" id="navMenu" onclick="showPage('menu'); return false;">üìã D·ªãch v·ª•</a>
        <a href="#" data-page="orders" id="navOrders" onclick="showPage('orders'); return false;">üßæ H√≥a ƒë∆°n</a>
        <a href="#" data-page="customers" id="navCustomers" onclick="showPage('customers'); return false;">üë• Kh√°ch h√†ng</a>
        <a href="#" data-page="dashboard" id="navDashboard" onclick="showPage('dashboard'); return false;">üìä Th·ªëng k√™</a>
        <a href="#" data-page="employees" id="navEmployees" onclick="showPage('employees'); return false;">üë®‚Äçüç≥ Nh√¢n vi√™n</a>
      </nav>
      <div style="margin-top:20px" class="small">Tr·∫°ng th√°i</div>
        <div style="display:flex;gap:8px;margin-top:8px;flex-wrap:wrap" id="statusPills">
        <div class="pill">ƒêang t·∫£i...</div>
      </div>
      <div style="margin-top: auto; padding-top: 20px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
        <div class="small" style="margin-bottom: 8px;">ƒêƒÉng nh·∫≠p b·ªüi:</div>
        <div style="font-size: 13px; color: #e6eef6; margin-bottom: 12px;" id="employeeInfo">
          <div id="employeeName">-</div>
          <div class="small" id="employeeRole">-</div>
        </div>
        <button class="pill" onclick="handleLogout()" style="width: 100%; justify-content: center;">
          ƒêƒÉng xu·∫•t
        </button>
      </div>
    </aside>

    <!-- Main Content Area -->
    <main class="main">

      <!-- Dashboard Section -->
      <section id="dashboard" class="view" style="display:none">
        <div style="display:flex;justify-content:flex-end;margin-bottom:12px">
          <button class="pill" onclick="refreshSection('dashboard')" title="L√†m m·ªõi">‚ü≥ L√†m m·ªõi</button>
        </div>
        <div class="grid-4">
          <div class="card">
            <h3>Doanh thu h√¥m nay</h3>
            <p id="todayRevenue">‚Ç´ 0</p>
          </div>
          <div class="card">
            <h3>ƒê∆°n h√†ng (h√¥m nay)</h3>
            <p id="todayOrders">0</p>
          </div>
          <div class="card">
            <h3>B√†n ƒëang ph·ª•c v·ª•</h3>
            <p id="occupiedTables">0 / 0</p>
          </div>
          <div class="card">
            <h3>Nguy√™n li·ªáu c·∫ßn nh·∫≠p</h3>
            <p id="lowStock">0 m·ª•c</p>
          </div>
        </div>

        <div class="panel">
          <h3 style="margin-top:0">Danh s√°ch b√†n</h3>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>T√™n</th>
                <th>Khu v·ª±c</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="tablesList">
              <tr><td colspan="5" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>

        <div class="panel">
          <h3 style="margin-top:0">ƒê∆°n h√†ng m·ªõi nh·∫•t</h3>
          <table>
            <thead>
              <tr>
                <th>M√£</th>
                <th>Kh√°ch</th>
                <th>Lo·∫°i</th>
                <th>T·ªïng</th>
                <th>Tr·∫°ng th√°i</th>
              </tr>
            </thead>
            <tbody id="ordersList">
              <tr><td colspan="5" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Tables Section -->
      <section id="tables" class="view">
        <div class="panel">
          <h3 style="margin-top:0">B·∫£ng ƒëi·ªÅu khi·ªÉn B√†n</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="small">Qu·∫£n l√Ω b·ªë tr√≠ b√†n, tr·∫°ng th√°i</div>
            <div style="display:flex;gap:8px;">
              <button class="pill" onclick="refreshSection('tables')" title="L√†m m·ªõi">‚ü≥</button>
              <button class="btn" onclick="openModal('newTable')">+ Th√™m B√†n</button>
            </div>
          </div>
          <!-- B·ªô l·ªçc t√¨m ki·∫øm -->
          <div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap;align-items:center;">
            <input type="text" id="filterTableName" placeholder="T√¨m theo t√™n b√†n..." 
                   oninput="filterTables()" 
                   style="flex:1;min-width:200px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;" />
            <input type="text" id="filterTableArea" placeholder="T√¨m theo khu v·ª±c..." 
                   oninput="filterTables()" 
                   style="flex:1;min-width:200px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;" />
            <select id="filterTableStatus" onchange="filterTables()" 
                    style="flex:1;min-width:150px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;">
              <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
              <option value="Tr·ªëng">Tr·ªëng</option>
              <option value="ƒê·∫∑t tr∆∞·ªõc">ƒê·∫∑t tr∆∞·ªõc</option>
              <option value="ƒêang s·ª≠ d·ª•ng">ƒêang s·ª≠ d·ª•ng</option>
              <option value="S·ª≠a ch·ªØa">S·ª≠a ch·ªØa</option>
            </select>
          </div>
          <div id="tablesGrid" class="tables-card-grid">
            <div class="loading">ƒêang t·∫£i...</div>
          </div>
        </div>
      </section>

      <!-- Menu Section -->
      <section id="menu" class="view" style="display:none">
        <div class="panel">
          <h3 style="margin-top:0">Qu·∫£n l√Ω Menu</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="small">Th√™m, ch·ªânh s·ª≠a, v√¥ hi·ªáu h√≥a m√≥n</div>
            <div style="display:flex;gap:8px;">
              <button class="pill" onclick="refreshSection('menu')" title="L√†m m·ªõi">‚ü≥</button>
              <button class="btn" onclick="openModal('newMenu')">+ Th√™m M√≥n</button>
            </div>
          </div>
          <!-- B·ªô l·ªçc t√¨m ki·∫øm -->
          <div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap;align-items:center;">
            <input type="text" id="filterMenuName" placeholder="T√¨m theo t√™n m√≥n..." 
                   oninput="filterMenu()" 
                   style="flex:1;min-width:200px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;" />
            <select id="filterMenuCategory" onchange="filterMenu()" 
                    style="flex:1;min-width:150px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;">
              <option value="">T·∫•t c·∫£ danh m·ª•c</option>
            </select>
            <select id="filterMenuPrice" onchange="filterMenu()" 
                    style="flex:1;min-width:150px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;">
              <option value="">T·∫•t c·∫£ gi√°</option>
              <option value="0-50000">D∆∞·ªõi 50,000‚Ç´</option>
              <option value="50000-100000">50,000‚Ç´ - 100,000‚Ç´</option>
              <option value="100000-200000">100,000‚Ç´ - 200,000‚Ç´</option>
              <option value="200000-">Tr√™n 200,000‚Ç´</option>
            </select>
          </div>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>T√™n</th>
                <th>Danh m·ª•c</th>
                <th>Gi√°</th>
                <th>Ho·∫°t ƒë·ªông</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="menuTable">
              <tr><td colspan="6" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Orders Section -->
      <section id="orders" class="view" style="display:none">
        <div class="panel">
          <h3 style="margin-top:0">ƒê∆°n h√†ng</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="small">T·∫°o ƒë∆°n, c·∫≠p nh·∫≠t tr·∫°ng th√°i</div>
            <div style="display:flex;gap:8px;">
              <button class="pill" onclick="refreshSection('orders')" title="L√†m m·ªõi">‚ü≥</button>
              <button class="btn" onclick="openModal('newOrder')">+ T·∫°o ƒê∆°n</button>
            </div>
          </div>
          <!-- B·ªô l·ªçc t√¨m ki·∫øm -->
          <div style="display:flex;gap:12px;margin-bottom:16px;flex-wrap:wrap;align-items:center;">
            <select id="filterOrderStatus" onchange="filterOrders()" 
                    style="flex:1;min-width:150px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;">
              <option value="">T·∫•t c·∫£ t√¨nh tr·∫°ng</option>
              <option value="pending">ƒêang ph·ª•c v·ª• </option>
              <option value="completed">Ho√†n th√†nh</option>
            </select>
            <input type="text" id="filterOrderCustomer" placeholder="T√¨m theo t√™n kh√°ch h√†ng..." 
                   oninput="filterOrders()" 
                   style="flex:1;min-width:200px;padding:8px;border:1px solid #d1d5db;border-radius:6px;font-size:14px;" />
          </div>
          <table>
            <thead>
              <tr>
                <th>M√£</th>
                <th>B√†n</th>
                <th>Kh√°ch</th>
                <th>T·ªïng</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="ordersAdmin">
              <tr><td colspan="6" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Customers Section -->
      <section id="customers" class="view" style="display:none">
        <div class="panel">
          <h3 style="margin-top:0">Kh√°ch h√†ng</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="small">Qu·∫£n l√Ω th√¥ng tin kh√°ch h√†ng</div>
            <div style="display:flex;gap:8px;">
              <button class="pill" onclick="refreshSection('customers')" title="L√†m m·ªõi">‚ü≥</button>
              <button class="btn" onclick="openModal('newCustomer')">+ Th√™m Kh√°ch</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>T√™n</th>
                <th>ƒêi·ªán tho·∫°i</th>
                <th>Lo·∫°i</th>
                <th>ƒêi·ªÉm</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="customersTable">
              <tr><td colspan="6" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Inventory Section -->
      <section id="inventory" class="view" style="display:none">
        <div class="panel">
          <h3 style="margin-top:0">Kho h√†ng</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="small">Qu·∫£n l√Ω nh·∫≠p kho, t·ªìn kho</div>
            <div style="display:flex;gap:8px;">
              <button class="pill" onclick="refreshSection('inventory')" title="L√†m m·ªõi">‚ü≥</button>
              <button class="btn" onclick="openModal('newInventory')">+ Nh·∫≠p Kho</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>T√™n</th>
                <th>S·ªë l∆∞·ª£ng</th>
                <th>ƒê∆°n v·ªã</th>
                <th>Gi√° ƒë∆°n v·ªã</th>
                <th>Nh√† cung c·∫•p</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="inventoryTable">
              <tr><td colspan="7" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Employees Section -->
      <section id="employees" class="view" style="display:none">
        <div class="panel">
          <h3 style="margin-top:0">Nh√¢n vi√™n</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="small">Qu·∫£n l√Ω th√¥ng tin nh√¢n vi√™n</div>
            <div style="display:flex;gap:8px;">
              <button class="pill" onclick="refreshSection('employees')" title="L√†m m·ªõi">‚ü≥</button>
              <button class="btn" onclick="openModal('newEmployee')">+ Th√™m Nh√¢n vi√™n</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>T√™n</th>
                <th>Vai tr√≤</th>
                <th>ƒêi·ªán tho·∫°i</th>
                <th>L∆∞∆°ng</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
              </tr>
            </thead>
            <tbody id="employeesTable">
              <tr><td colspan="7" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Payments Section -->
      <section id="payments" class="view" style="display:none">
        <div class="panel">
          <h3 style="margin-top:0">Thanh to√°n</h3>
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
            <div class="small">Qu·∫£n l√Ω thanh to√°n v√† doanh thu</div>
            <div style="display:flex;gap:8px;">
              <button class="pill" onclick="refreshSection('payments')" title="L√†m m·ªõi">‚ü≥</button>
              <button class="btn" onclick="openModal('newPayment')">+ Th√™m Thanh to√°n</button>
            </div>
          </div>
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>ƒê∆°n h√†ng</th>
                <th>S·ªë ti·ªÅn</th>
                <th>Ph∆∞∆°ng th·ª©c</th>
                <th>Th·ªùi gian</th>
              </tr>
            </thead>
            <tbody id="paymentsTable">
              <tr><td colspan="5" class="loading">ƒêang t·∫£i...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Settings Section -->
      <section id="settings" class="view" style="display:none">
        <div class="panel">
          <h3 style="margin-top:0">C√†i ƒë·∫∑t</h3>
          <div class="small" style="margin-bottom:12px">Qu·∫£n l√Ω danh m·ª•c v√† c·∫•u h√¨nh h·ªá th·ªëng</div>
          
          <div style="margin-bottom:20px">
            <h4>Danh m·ª•c m√≥n ƒÉn</h4>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
              <div class="small">Qu·∫£n l√Ω c√°c danh m·ª•c cho menu</div>
              <div style="display:flex;gap:8px;">
                <button class="pill" onclick="refreshSection('categories')" title="L√†m m·ªõi">‚ü≥</button>
                <button class="btn" onclick="openModal('newCategory')">+ Th√™m Danh m·ª•c</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>T√™n</th>
                  <th>M√¥ t·∫£</th>
                  <th>H√†nh ƒë·ªông</th>
                </tr>
              </thead>
              <tbody id="categoriesTable">
                <tr><td colspan="4" class="loading">ƒêang t·∫£i...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <footer>¬© 2025 Qu·∫£n L√Ω Nh√† H√†ng ‚Äî Giao di·ªán qu·∫£n l√Ω nh√† h√†ng</footer>
    </main>
  </div>

  <!-- Modal -->
  <div id="modalBackdrop" class="modal-backdrop" onclick="closeModal(event)">
    <div id="modalContent" class="modal" onclick="event.stopPropagation()"></div>
  </div>

  <script src="/js/api.js"></script>
  <script src="/js/app.js"></script>
  <script src="/js/pages.js"></script>
  <script src="/js/modals.js"></script>
  <script>
    // Ph√¢n quy·ªÅn d·ª±a tr√™n role
    function setupRoleBasedAccess() {
      const employeeRole = sessionStorage.getItem('employeeRole');
      
      if (!employeeRole) {
        // N·∫øu kh√¥ng c√≥ role, redirect v·ªÅ login
        window.location.href = '/login.html';
        return;
      }
      
      // ADMIN: th·∫•y t·∫•t c·∫£ - kh√¥ng c·∫ßn ·∫©n g√¨
      if (employeeRole === 'ADMIN') {
        return;
      }
      
      // Qu·∫£n_l√Ω: th·∫•y t·∫•t c·∫£ menu nh∆∞ng s·∫Ω filter admin trong trang nh√¢n vi√™n
      if (employeeRole === 'Qu·∫£n_l√Ω' || employeeRole === 'manager') {
        return;
      }
      
      // C√°c role kh√°c (Ph·ª•c_v·ª•, Thu_ng√¢n, ƒê·∫ßu_b·∫øp): ch·ªâ th·∫•y Tr·∫°ng th√°i b√†n
      const navMenu = document.getElementById('navMenu');
      const navOrders = document.getElementById('navOrders');
      const navCustomers = document.getElementById('navCustomers');
      const navDashboard = document.getElementById('navDashboard');
      const navEmployees = document.getElementById('navEmployees');
      
      if (navMenu) navMenu.style.display = 'none';
      if (navOrders) navOrders.style.display = 'none';
      if (navCustomers) navCustomers.style.display = 'none';
      if (navDashboard) navDashboard.style.display = 'none';
      if (navEmployees) navEmployees.style.display = 'none';
      
      // ·∫®n c√°c section t∆∞∆°ng ·ª©ng
      const sections = document.querySelectorAll('section.view');
      sections.forEach(section => {
        const sectionId = section.id;
        if (sectionId !== 'tables') {
          section.style.display = 'none';
        }
      });
    }
    
    // Ki·ªÉm tra quy·ªÅn truy c·∫≠p trang
    function checkPageAccess(pageName) {
      const employeeRole = sessionStorage.getItem('employeeRole');
      
      if (!employeeRole) {
        window.location.href = '/login.html';
        return false;
      }
      
      // ADMIN v√† Qu·∫£n_l√Ω: c√≥ quy·ªÅn truy c·∫≠p t·∫•t c·∫£
      if (employeeRole === 'ADMIN' || employeeRole === 'Qu·∫£n_l√Ω' || employeeRole === 'manager') {
        return true;
      }
      
      // C√°c role kh√°c: ch·ªâ ƒë∆∞·ª£c truy c·∫≠p trang tables
      if (pageName === 'tables') {
        return true;
      }
      
      // N·∫øu kh√¥ng c√≥ quy·ªÅn, redirect v·ªÅ trang tables
      alert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang n√†y');
      showPage('tables');
      return false;
    }
    
    // Override showPage function ƒë·ªÉ ki·ªÉm tra quy·ªÅn
    const originalShowPage = window.showPage;
    window.showPage = function(pageName) {
      if (checkPageAccess(pageName)) {
        if (originalShowPage) {
          originalShowPage(pageName);
        }
      }
    };
    
    // Hi·ªÉn th·ªã th√¥ng tin nh√¢n vi√™n ƒë√£ ƒëƒÉng nh·∫≠p
    window.addEventListener('DOMContentLoaded', function() {
      const employeeName = sessionStorage.getItem('employeeName');
      const employeeRole = sessionStorage.getItem('employeeRole');
      
      if (employeeName) {
        document.getElementById('employeeName').textContent = employeeName;
      }
      
      if (employeeRole) {
        // Format role ƒë·ªÉ hi·ªÉn th·ªã
        const roleMap = {
          'ADMIN': 'Qu·∫£n tr·ªã vi√™n',
          'Ph·ª•c_v·ª•': 'Ph·ª•c v·ª•',
          'Thu_ng√¢n': 'Thu ng√¢n',
          'ƒê·∫ßu_b·∫øp': 'ƒê·∫ßu b·∫øp',
          'Qu·∫£n_l√Ω': 'Qu·∫£n l√Ω',
          'waiter': 'Ph·ª•c v·ª•',
          'cashier': 'Thu ng√¢n',
          'chef': 'ƒê·∫ßu b·∫øp',
          'manager': 'Qu·∫£n l√Ω'
        };
        document.getElementById('employeeRole').textContent = roleMap[employeeRole] || employeeRole.replace(/_/g, ' ');
      }
      
      // Setup ph√¢n quy·ªÅn
      setupRoleBasedAccess();
    });
    
    // X·ª≠ l√Ω ƒëƒÉng xu·∫•t
    function handleLogout() {
      if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën ƒëƒÉng xu·∫•t?')) {
        // X√≥a session storage
        sessionStorage.removeItem('employeeId');
        sessionStorage.removeItem('employeeName');
        sessionStorage.removeItem('employeeRole');
        sessionStorage.removeItem('isAuthenticated');
        
        // Redirect ƒë·∫øn trang login
        window.location.href = '/login.html';
      }
    }
  </script>
</body>
</html>
